window.BellaAIVoiceWS=null,window.BellaAIVoiceActive=!1,window.BellaAISeenAudio=window.BellaAISeenAudio||new Set,window.BellaAIEarlyAudioBuffer=[],window.BellaAISpeakingFrames=0,window.BellaAIVoiceChatAudio={q:[],audioCtx:null,playing:!1,currentSrc:null,currentGain:null,paused:!1,agentSpeaking:!1,_resumeTimeout:null,_lastB64:null,enqueue(e,t){t?(this.audioCtx=t,this.q.push(e),console.log("[BellaAI][AUDIO] Enqueued audio chunk. Queue length:",this.q.length),this.playing||this.paused||this._playNext()):console.warn("[BellaAI][AUDIO] enqueue: No audio context provided")},_playNext(){var e;this.paused?console.log("[BellaAI][AUDIO] _playNext: Paused, not playing next chunk"):window.BellaAITranscriptTracking.abortCurrentResponse?(console.log("[BellaAI][AUDIO] _playNext: Aborting due to interrupt flag"),this.stop()):(e=this.q.shift())?(this.playing=!0,console.log("[BellaAI][AUDIO] _playNext: Decoding and playing next chunk"),this._decodeAndBuffer(e,this.audioCtx).then(e=>{if(this.audioCtx&&"closed"!==this.audioCtx.state){if(this.currentSrc){try{this.currentSrc.stop(0)}catch(e){}try{this.currentSrc.disconnect()}catch(e){}this.currentSrc=null}var t=this.audioCtx.createBufferSource(),a=(t.buffer=e,this.audioCtx.createGain());a.gain.value=1,t.connect(a),a.connect(this.audioCtx.destination),this.currentSrc=t,this.agentSpeaking=!0,console.log("[BellaAI][AUDIO] Starting audio playback, buffer length:",e.length),t.onended=()=>{console.log("[BellaAI][AUDIO] Audio playback ended"),this.agentSpeaking=!1,this.currentSrc=null,this._playNext()};try{t.start(0),console.log("[BellaAI][AUDIO] Audio playback started")}catch(e){console.error("[BellaAI][AUDIO] Error starting audio source:",e),this.currentSrc=null,this.agentSpeaking=!1,this._playNext()}}else console.error("[BellaAI][AUDIO] AudioContext is closed, cannot play audio"),this.playing=!1}).catch(e=>{console.error("[BellaAI][AUDIO] Error decoding/playing audio:",e),this.currentSrc=null,this._playNext()})):(this.playing=!1,this.currentSrc=null,this.agentSpeaking=!1,console.log("[BellaAI][AUDIO] _playNext: Queue empty, agent done speaking"))},_decodeAndBuffer(s,d){return this._lastB64=s,console.log("[BellaAI] Decoding audio chunk, length:",s.length),new Promise((e,t)=>{try{if(!s||s.length<100)console.error("[BellaAI] Invalid base64 data in _decodeAndBuffer:",s.length),t(new Error("Invalid base64 data"));else if(d&&"closed"!==d.state){var a=atob(s),o=(console.log("[BellaAI] Decoded binary length:",a.length),new ArrayBuffer(a.length)),i=new Uint8Array(o);for(let e=0;e<a.length;e++)i[e]=a.charCodeAt(e);var n=new Int16Array(Math.floor(i.length/2));for(let e=0,t=0;e<i.length-1;e+=2,t++)n[t]=255&i[e]|(255&i[e+1])<<8;console.log("[BellaAI] Created Int16Array with",n.length,"samples");var r=d.createBuffer(1,n.length,16e3),l=r.getChannelData(0);for(let e=0;e<n.length;e++)l[e]=n[e]/32768;console.log("[BellaAI] Successfully created audio buffer"),e(r)}else console.error("[BellaAI] Invalid or closed audio context"),t(new Error("Invalid audio context"))}catch(e){console.error("[BellaAI] Error in _decodeAndBuffer:",e),t(e)}})},pause(){if(this.paused)console.log("[BellaAI][AUDIO] pause: Already paused");else if(this.paused=!0,console.log("[BellaAI][AUDIO] pause: Pausing playback"),this.currentSrc){try{this.currentSrc.stop(0)}catch(e){}this.currentSrc.disconnect(),this.currentSrc.buffer&&this._lastB64&&(this.q.unshift(this._lastB64),console.log("[BellaAI][AUDIO] pause: Pushed last chunk back to queue")),this.currentSrc=null}},resume(){this.paused?(this.paused=!1,console.log("[BellaAI][AUDIO] resume: Resuming playback"),this._playNext()):console.log("[BellaAI][AUDIO] resume: Not paused")},stop(){if(this.currentSrc){try{this.currentSrc.stop(0)}catch(e){}this.currentSrc.disconnect(),this.currentSrc=null,console.log("[BellaAI][AUDIO] stop: Stopped current source")}this.q=[],this.playing=!1,this.paused=!1,this.agentSpeaking=!1,this.audioCtx&&"running"===this.audioCtx.state&&(this.audioCtx.suspend().catch(()=>{}),console.log("[BellaAI][AUDIO] stop: Suspended audio context")),this.audioCtx=null,console.log("[BellaAI][AUDIO] stop: Cleared queue and reset state")}},window.BellaAITranscriptTracking={lastUserTranscriptId:null,lastAgentResponseId:null,processedResponses:new Set,currentConversationId:null,voiceModeAnnounced:!1,defaultGreetingShown:!1,lastResponseText:null,lastAudioId:null,abortCurrentResponse:!1,reset:function(){this.lastUserTranscriptId=null,this.lastAgentResponseId=null,this.processedResponses.clear(),this.currentConversationId=null,this.voiceModeAnnounced=!1,this.defaultGreetingShown=!1,this.lastResponseText=null,this.lastAudioId=null,this.abortCurrentResponse=!1},isResponseProcessed:function(e){return!!e&&(this.processedResponses.has(e)||this.lastAgentResponseId===e)},markResponseProcessed:function(e){e&&(this.lastAgentResponseId=e,this.processedResponses.add(e))}},(()=>{let t=()=>{try{let e=new(window.AudioContext||window.webkitAudioContext);e.resume().then(()=>e.close()).catch(()=>{}),window.BellaAIVoiceChatAudio&&window.BellaAIVoiceChatAudio.audioCtx&&window.BellaAIVoiceChatAudio.audioCtx.resume().catch(()=>{})}catch(e){console.log("[BellaAI] Audio context unlock attempt error (non-critical):",e)}};["touchend","touchstart","click","keydown"].forEach(e=>window.addEventListener(e,t,{once:!0,passive:!0}))})(),(()=>{console.log("ChatVersion:","2.0");let g="";(async()=>{try{var e=await(await fetch("https://api.ipify.org?format=json")).json();g=e.ip,console.log("User IP collected for chat")}catch(e){console.error("Error fetching IP:",e),g="unknown"}})();var e={webhook:{url:"",route:""},branding:{logo:"https://cdn-icons-png.flaticon.com/512/5962/5962463.png",name:"Bella : Product Specialist",welcomeText:""},style:{primaryColor:"#003f72",secondaryColor:"#003f72",position:"right",backgroundColor:"#ffffff",fontColor:"#333333"},dealer:{name:"",phone:"",website:"",searchPage:"",provider:""},overtake:!1};let x=window.ChatWidgetConfig?{webhook:{...e.webhook,...window.ChatWidgetConfig.webhook},branding:{...e.branding,...window.ChatWidgetConfig.branding},style:{...e.style,...window.ChatWidgetConfig.style},dealer:{...e.dealer,...window.ChatWidgetConfig.dealer},overtake:window.ChatWidgetConfig.overtake||!1,overtakePath:window.ChatWidgetConfig.overtakePath||"/"}:e;if(window.BellaAIChatWidgetInitialized)return;let t=!(window.BellaAIChatWidgetInitialized=!0);function a(e){try{var t={manuallyClosed:e,timestamp:(new Date).getTime()};localStorage.setItem("bellaaiChatState",JSON.stringify(t))}catch(e){console.error("Error saving chat state:",e)}}function o(){return"undefined"!=typeof crypto&&"function"==typeof crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function u(e){var t;return e?(t=/<[a-z][\s\S]*>/i.test(e),e=e.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank">$1</a>'),(e=(e=(e=t?e:e.replace(/(https?:\/\/[^\s<]+)(?![^<]*>)/g,'<a href="$1" target="_blank">Visit Website</a>')).replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>")).replace(/\*([^*]+)\*/g,"<em>$1</em>")).replace(/\n/g,"<br>")):""}function m(){var e=document.getElementById("thinking-animation");e&&e.remove()}window.initialUtmParameters=(e=>{let a={};try{var o=new URL(e);let t=new URLSearchParams(o.search);var i,n,r=["utm_source","utm_medium","utm_campaign","utm_term","utm_content"];r.forEach(function(e){t.has(e)&&(a[e]=t.get(e))});for([i,n]of t.entries())i.startsWith("utm_")&&!r.includes(i)&&(a[i]=n)}catch(e){console.error("Error extracting UTM parameters:",e)}return a})(window.location.href),console.log("Initial UTM Parameters:",window.initialUtmParameters);let y="";function b(){if(y)try{var e={sessionId:y,messages:Array.from(k.children).filter(function(e){return e.classList.contains("chat-message")}).map(function(e){return{type:e.classList.contains("user")?"user":"bot",content:e.classList.contains("user")?e.textContent:e.innerHTML}}),inactivityMessageSent:w,promptBubbleShown:r,timestamp:(new Date).getTime(),utmParameters:window.initialUtmParameters||{}};localStorage.setItem("bellaaiChatSession",JSON.stringify(e))}catch(e){console.error("Error saving chat session:",e)}}function i(){try{var e=localStorage.getItem("bellaaiChatSession");if(e){var t=JSON.parse(e),a=(new Date).getTime()-t.timestamp;if(a<864e5)return k.innerHTML="",y=t.sessionId,t.inactivityMessageSent&&(w=!0),t.promptBubbleShown&&(r=!0),t.utmParameters&&(window.initialUtmParameters=t.utmParameters),t.messages&&0<t.messages.length&&t.messages.forEach(function(e){var t=document.createElement("div");t.className="chat-message "+e.type,"user"===e.type?t.textContent=e.content:t.innerHTML=e.content,k.appendChild(t)}),!0;localStorage.removeItem("bellaaiChatSession")}}catch(e){console.error("Error loading saved chat session:",e),localStorage.removeItem("bellaaiChatSession")}return!1}let f,P=12e4,w=!1;function v(){clearTimeout(f),w||(f=setTimeout(function(){var e;d.classList.contains("open")&&y&&((e=document.createElement("div")).className="chat-message bot",e.innerHTML=u("Do you have any questions I can help with?"),k.appendChild(e),k.scrollTop=k.scrollHeight,w=!0,b())},P))}let n,r=!1;function H(){var e=document.getElementById("prompt-bubble");e&&e.remove()}var l,e=`
      .bellaai-chat-widget {
        --chat--color-primary: ${x.style.primaryColor};
        --chat--color-secondary: ${x.style.secondaryColor};
        font-family: 'Geist Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      }
      .bellaai-chat-widget .chat-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 2147483647;
        width: 380px;
        height: 600px;
        background: #ffffff;
        border-radius: 12px !important;
        box-shadow: 0 8px 32px rgba(133, 79, 255, 0.15);
        border: 1px solid rgba(133, 79, 255, 0.2);
        overflow: hidden;
        opacity: 0;
        transform-origin: bottom right;
        transform: scale(0);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        pointer-events: none;
        display: flex;
        flex-direction: column;
        visibility: hidden;
      }
      @media screen and (max-width: 600px) {
        .bellaai-chat-widget .chat-container {
          width: 100%;
          height: 100%;
          bottom: 0;
          right: 0;
          border-radius: 0;
          box-shadow: none;
        }
        .bellaai-chat-widget .chat-container.position-left {
          left: 0;
        }
      }
      .bellaai-chat-widget .chat-container.position-left {
        right: auto;
        left: 20px;
        transform-origin: bottom left;
      }
      .bellaai-chat-widget .chat-container.open {
        opacity: 1;
        transform: scale(1);
        pointer-events: all;
        visibility: visible;
      }
      .bellaai-chat-widget .brand-header {
        padding: 16px;
        display: flex;
        align-items: center;
        gap: 12px;
        border-bottom: 1px solid rgba(133, 79, 255, 0.1);
        position: relative;
      }
      .bellaai-chat-widget .close-button {
        position: absolute;
        right: 16px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        cursor: pointer;
        font-size: 20px;
        opacity: 0.6;
      }
      .bellaai-chat-widget .brand-header img {
        width: 32px;
        height: 32px;
      }
      .bellaai-chat-widget .brand-header span {
        font-size: 18px;
        font-weight: 500;
      }
      .bellaai-chat-widget .chat-interface {
        display: flex;
        flex-direction: column;
        height: 100%;
      }
      .bellaai-chat-widget .chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
        display: flex;
        flex-direction: column;
      }
      .bellaai-chat-widget .chat-message {
        padding: 12px 16px;
        margin: 8px 0;
        border-radius: 12px;
        max-width: 80%;
        word-wrap: break-word;
        font-size: 14px;
        line-height: 1.5;
      }
      .bellaai-chat-widget .chat-message.user {
        background: linear-gradient(135deg, var(--chat--color-primary) 0%, var(--chat--color-secondary) 100%);
        color: #fff;
        align-self: flex-end;
        box-shadow: 0 4px 12px rgba(133, 79, 255, 0.2);
        border-radius: 12px;
        padding: 12px 16px;
        margin: 8px 0;
        max-width: 80%;
        word-wrap: break-word;
        font-size: 14px;
        line-height: 1.5;
      }
      .bellaai-chat-widget .chat-message.bot {
        background: #ffffff;
        border: 1px solid rgba(133, 79, 255, 0.2);
        color: #333;
        align-self: flex-start;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      }
      .bellaai-chat-widget .chat-message.bot a {
        color: var(--chat--color-primary);
        text-decoration: none;
        font-weight: 500;
      }
      .bellaai-chat-widget .chat-message.bot a:hover {
        text-decoration: underline;
      }
      .bellaai-chat-widget .chat-message.bot a:hover {
        text-decoration: underline;
      }
      .bellaai-chat-widget .chat-input {
        padding: 16px;
        border-top: 1px solid rgba(133, 79, 255, 0.1);
        display: flex;
        gap: 8px;
      }
      .bellaai-chat-widget .chat-input textarea {
        flex: 1 !important;
        padding: 12px !important;
        border: 1px solid rgba(133, 79, 255, 0.2) !important;
        border-radius: 8px !important;
        resize: none !important;
        font-family: inherit !important;
        font-size: 14px !important;
        height: auto !important;
        min-height: 40px !important;
        max-height: 120px !important;
        width: auto !important;
        box-sizing: border-box !important;
      }
      .bellaai-chat-widget .chat-input button {
        background: linear-gradient(135deg, var(--chat--color-primary) 0%, var(--chat--color-secondary) 100%);
        color: #fff;
        border: none;
        border-radius: 8px;
        padding: 0 18px;
        cursor: pointer;
        font-weight: 500;
        font-size: 16px;
        height: 40px;
        min-width: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .bellaai-chat-widget .chat-input button svg {
        fill: #fff;
        stroke: #fff;
      }
    .bellaai-chat-widget .chat-toggle {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px 20px;
      background: linear-gradient(135deg, var(--chat--color-primary) 0%, var(--chat--color-secondary) 100%);
      color: white;
      border: none;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(133, 79, 255, 0.3);
      z-index: 2147483647;
      border-radius: 30px !important;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      opacity: 1;
      transform: scale(1);
    }
    
    .bellaai-chat-widget .chat-toggle.hidden {
      opacity: 0;
      transform: scale(0.8);
      pointer-events: none;
    }
    
    .bellaai-chat-widget .chat-toggle-content {
      display: flex;
      align-items: center;
      gap: 12px;
      position: relative;
    }
    
    .bellaai-chat-widget .chat-toggle svg {
      width: 24px;
      height: 24px;
      fill: currentColor;
      color: white;
    }
    
    .bellaai-chat-widget .chat-toggle-text {
      font-size: 16px;
      font-weight: 500;
      white-space: nowrap;
      line-height: 24px;
    }
    
    .bellaai-chat-widget .online-indicator {
      position: absolute;
      top: -20px;
      right: -4px;
      width: 12px;
      height: 12px;
      background-color: #22c55e;
      border-radius: 50%;
      border: 2px solid white;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4);
      }
      70% {
        box-shadow: 0 0 0 10px rgba(34, 197, 94, 0);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(34, 197, 94, 0);
      }
    }
    
    /* Update mobile styles for online indicator */
    @media screen and (max-width: 600px) {
      .bellaai-chat-widget .chat-toggle {
        width: 60px;
        height: 60px;
        padding: 0;
        justify-content: center;
      }
    
      .bellaai-chat-widget .chat-toggle-text {
        display: none;
      }
      
      .bellaai-chat-widget .online-indicator {
        top: -20px;
        right: -4px;
      }
    }
    
        .bellaai-chat-widget .chat-toggle.position-left {
          right: auto;
          left: 20px;
        }
        .bellaai-chat-widget .chat-toggle svg {
          width: 24px;
          height: 24px;
          fill: currentColor;
        }
        .bellaai-chat-widget .thinking {
          display: flex;
          align-items: center;
          padding: 12px 16px;
          margin: 8px 0;
          border-radius: 12px;
          max-width: 80%;
          align-self: flex-start;
          background: #fff;
          border: 1px solid rgba(133, 79, 255, 0.2);
          gap: 8px;
        }
        .bellaai-chat-widget .thinking span {
          color: #666;
          font-size: 14px;
        }
        .bellaai-chat-widget .dots {
          display: flex;
          gap: 2px;
        }
        .bellaai-chat-widget .dot {
          height: 8px;
          width: 8px;
          background-color: var(--chat--color-primary);
          border-radius: 50%;
          display: inline-block;
          opacity: 0.4;
          animation: dot-typing 1.4s infinite ease-in-out;
        }
        .bellaai-chat-widget .dot:nth-child(1) { animation-delay: 0s; }
        .bellaai-chat-widget .dot:nth-child(2) { animation-delay: 0.2s; }
        .bellaai-chat-widget .dot:nth-child(3) { animation-delay: 0.4s; }
        /* Prompt bubble styles */
        .bellaai-chat-widget .prompt-bubble {
          position: absolute;
          bottom: 90px;
          right: 10px;
          background: white;
          color: var(--chat--color-primary);
          padding: 8px 14px;
          border-radius: 18px;
          font-size: 14px;
          font-weight: 500;
          box-shadow: 0 2px 12px rgba(0, 0, 0, 0.15);
          cursor: pointer;
          z-index: 2147483646;
          border: 1px solid rgba(133, 79, 255, 0.2);
          animation: bounce-in 0.5s;
        }
        /* Position the prompt bubble on the left if chat is on the left */
        .bellaai-chat-widget .chat-toggle.position-left + .prompt-bubble {
          right: auto;
          left: 10px;
        }
        @keyframes bounce-in {
          0% { transform: scale(0.5); opacity: 0; }
          50% { transform: scale(1.05); opacity: 0.9; }
          100% { transform: scale(1); opacity: 1; }
        }
        @keyframes dot-typing {
          0%, 60%, 100% { opacity: 0.4; transform: scale(1); }
          30% { opacity: 1; transform: scale(1.2); }
        }
      `;(l=document.createElement("style")).textContent=e,document.head.appendChild(l);let s=document.createElement("div"),d=(s.className="bellaai-chat-widget",document.createElement("div")),c=(d.className="chat-container"+("left"===x.style.position?" position-left":""),e=`
        <div class="chat-interface">
          <div class="brand-header">
            <img src="${x.branding.logo}" alt="${x.branding.name}">
            <span>${x.branding.name}</span>
            <button class="close-button">×</button>
          </div>
          <div class="chat-messages"></div>
          <div class="chat-input">
            <textarea placeholder="Type your message here..." rows="1"></textarea>
            <button type="submit">Send</button>
          </div>
        </div>
      `,d.innerHTML=e,document.createElement("button")),p=(c.className="chat-toggle"+("left"===x.style.position?" position-left":""),c.innerHTML=`
        <div class="chat-toggle-content">
          <div class="online-indicator"></div>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z" fill="currentColor"/>
          </svg>
          <span class="chat-toggle-text">Chat with us!</span>
        </div>
      `,"left"!==x.style.position&&(c.style.right="85px"),s.appendChild(d),s.appendChild(c),document.createElement("button")),k=(p.className="chat-toggle phone-toggle"+("left"===x.style.position?" position-left":""),p.innerHTML=`
        <div class="chat-toggle-content">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
          </svg>
        </div>
      `,p.style.position="fixed",p.style.bottom="20px",p.style.right=(x.style.position,"20px"),p.style.width="60px",p.style.height="60px",p.style.borderRadius="50%",p.style.display="flex",p.style.alignItems="center",p.style.justifyContent="center",p.style.background="linear-gradient(135deg, var(--chat--color-primary) 0%, var(--chat--color-secondary) 100%)",p.style.color="white",p.style.border="none",p.style.cursor="pointer",p.style.boxShadow="0 4px 12px rgba(133, 79, 255, 0.3)",p.style.zIndex="2147483646",p.style.padding="0",p.onclick=function(e){e.stopPropagation();e=document.getElementById("bellaai-phone-tooltip");if(e)e.remove();else{let a=document.createElement("div");a.id="bellaai-phone-tooltip",a.style.position="fixed",a.style.bottom="90px",a.style.right=(x.style.position,"20px"),a.style.background="white",a.style.boxShadow="0 2px 12px rgba(0,0,0,0.15)",a.style.borderRadius="8px",a.style.padding="10px",a.style.zIndex="2147483646",a.style.width="200px",a.style.boxSizing="border-box";e=document.createElement("style"),e=(e.textContent=`
          #bellaai-phone-tooltip::after {
            content: '';
            position: absolute;
            bottom: -10px;
            right: 30px;
            margin-left: -10px;
            border-width: 10px 10px 0;
            border-style: solid;
            border-color: white transparent transparent transparent;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.1));
          }
        `,document.head.appendChild(e),a.innerHTML=`
          <div style="font-size:0.9rem;font-weight:600;margin-bottom:8px;color:#333;">Call Me Now!</div>
          <div id="bellaai-phone-input-container" style="width:100%;box-sizing:border-box;">
            <input type="tel" id="bellaai-direct-phone-input" placeholder="Your phone number" style="width:100%;padding:8px;border-radius:4px;border:1px solid #ccc;margin-bottom:6px;font-size:0.85rem;box-sizing:border-box;">
            <button id="bellaai-direct-start-call" style="width:100%;padding:8px;border-radius:4px;background:#003f72;color:#fff;font-weight:500;font-size:0.85rem;border:none;cursor:pointer;box-sizing:border-box;">Start Call</button>
          </div>
          <div id="bellaai-direct-call-error" style="color:#c00;margin-top:8px;text-align:center;display:none;"></div>
        `,document.body.appendChild(a),p.getBoundingClientRect());a.getBoundingClientRect();a.style.right=window.innerWidth-e.right-e.width/2+30+"px",document.addEventListener("click",function e(t){a.contains(t.target)||t.target===p||(a.remove(),document.removeEventListener("click",e))}),document.getElementById("bellaai-direct-start-call").onclick=async function(){var e=document.getElementById("bellaai-direct-phone-input").value.trim(),t=document.getElementById("bellaai-direct-call-error");if(e)try{document.getElementById("bellaai-direct-phone-input").disabled=!0,document.getElementById("bellaai-direct-start-call").disabled=!0,document.getElementById("bellaai-direct-start-call").textContent="Connecting...",await _("phone_raw",e),t.style.color="#090",t.textContent="Call initiated! Please answer your phone.",t.style.display="block",setTimeout(()=>{a.remove()},3e3)}catch(e){t.textContent=e.message||"Couldn't connect your call. Please try again.",t.style.display="block",document.getElementById("bellaai-direct-phone-input").disabled=!1,document.getElementById("bellaai-direct-start-call").disabled=!1,document.getElementById("bellaai-direct-start-call").textContent="Start Call"}else t.textContent="Please enter your phone number.",t.style.display="block"}}},s.appendChild(p),document.body.appendChild(s),d.querySelector(".chat-interface"),d.querySelector(".chat-messages")),h=d.querySelector("textarea"),I=d.querySelector('button[type="submit"]'),C=d.querySelector(".close-button");function S(){var e,t=window.bellaaiTextarea||h||document.querySelector(".chat-input textarea");t?(e=t.value.trim())&&(["close","close chat","exit","quit","dismiss"].includes(e.toLowerCase())?((N?D:U)(),t.value=""):((async e=>{if(e.trim()){var t=document.createElement("div");t.className="chat-message user",t.textContent=e,k.appendChild(t),k.scrollTop=k.scrollHeight,(()=>{var e=document.createElement("div");e.className="thinking",e.innerHTML=`
        <span>Bella is typing</span>
        <div class="dots">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        </div>
      `,e.id="thinking-animation",k.appendChild(e),k.scrollTop=k.scrollHeight})();try{var o=A||await B(),i={chatInput:e,sessionId:y,metadata:{dealer:x.dealer,pageContext:o,utmParameters:window.initialUtmParameters||{},userIP:g}},n=await fetch(x.webhook.url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!n.ok)throw new Error("Failed to send message");let a="";var r=await n.text();try{var l=JSON.parse(r);Array.isArray(l)&&0<l.length&&l[0].output?a=l[0].output:l&&"object"==typeof l?a=l.output||l.response||l.message||"":"string"==typeof l&&(a=l)}catch(e){a=r}a&&""!==a.trim()||(a="I received your message, but I'm having trouble generating a response."),m();var s=a.match(/\[REDIRECT\](.*?)\[\/REDIRECT\]/);if(s&&s[1]){let t=(t=>{try{var e=new URL(t),a=new URLSearchParams(e.search);return a.set("utm_source","BellaAI"),a.set("utm_medium","chat"),a.set("utm_campaign","Drivonic-MarketBuilder-AIChat"),e.search=a.toString(),e.toString()}catch(e){return console.error("Error appending UTM parameters to URL:",e),t}})(s[1].trim());var d,c=a.replace(/\[REDIRECT\][\s\S]*?\[\/REDIRECT\]/g,"").trim();c&&((d=document.createElement("div")).className="chat-message bot",d.innerHTML=u(c),k.appendChild(d),k.scrollTop=k.scrollHeight),void setTimeout(()=>{var e=document.createElement("div");e.className="chat-message bot",e.innerHTML=u("Redirecting you now..."),k.appendChild(e),k.scrollTop=k.scrollHeight,b(),setTimeout(()=>{window.location.href=t},3e3)},1e3)}else{var p,h=a.replace(/\[REDIRECT\][\s\S]*?\[\/REDIRECT\]/g,"").trim();h&&((p=document.createElement("div")).className="chat-message bot",p.innerHTML=u(h),k.appendChild(p),k.scrollTop=k.scrollHeight),b(),w=!1,clearTimeout(f),v()}}catch(e){console.error("Error sending message:",e),m();t=document.createElement("div");t.className="chat-message bot",t.innerHTML=u("I apologize, but I'm having trouble connecting right now. Please try again in a moment."),k.appendChild(t),k.scrollTop=k.scrollHeight}}})(e),t.value="",t.style.height="auto")):console.error("[BellaAI] No textarea found for message sending")}c.addEventListener("click",function(){d.classList.contains("open")||(d.classList.add("open"),c.classList.add("hidden"),window.innerWidth<=600&&(document.body.style.overflow="hidden"),k.innerHTML="",i()||(w=!1,y=o(),B().then(()=>{z()})),b(),k.scrollTop=k.scrollHeight,v(),clearTimeout(n))}),C.addEventListener("click",function(){(N?D:U)(),a(t=!0),window.innerWidth<=600&&(document.body.style.overflow="")}),h.addEventListener("input",function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"}),I.addEventListener("click",S),h.addEventListener("keypress",function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),S())}),window.addEventListener("resize",function(){window.innerWidth<=600?d.classList.contains("open")&&(document.body.style.overflow="hidden"):document.body.style.overflow=""});let A=null,E=null;async function B(){try{var e=document.querySelector("main, #main, .main-content, .content");if(e){var t=(()=>{if(e=localStorage.getItem("bellai_nav_links"))return JSON.parse(e);let a=new Set;function t(e){e&&e.querySelectorAll("a[href]").forEach(e=>{var t=e.getAttribute("href"),e=e.textContent.trim();t&&!t.startsWith("#")&&!t.startsWith("javascript:")&&e&&(t=new URL(t,window.location.origin).href,a.add(JSON.stringify({text:e,url:t})))})}var e=document.querySelector("nav"),o=document.querySelector("header"),e=(e&&t(e),o&&t(o),0===a.size&&document.querySelectorAll('[class*="nav"]').forEach(e=>t(e)),Array.from(a).map(e=>JSON.parse(e)));return localStorage.setItem("bellai_nav_links",JSON.stringify(e)),e})(),a=(y=window.location.pathname.toLowerCase()).includes("/new-vehicles/")||y.includes("/used-vehicles/")?"inventory":y.includes("/finance")?"finance":y.includes("/service")?"service":y.includes("/parts")?"parts":y.includes("/about")?"about":y.includes("/contact")?"contact":"/"===y||"/index.html"===y?"home":"other",o=(e=>{if(!e)return"";for(var t=(e=e.cloneNode(!0)).getElementsByTagName("script");0<t.length;)t[0].parentNode.removeChild(t[0]);for(var a=e.getElementsByTagName("style");0<a.length;)a[0].parentNode.removeChild(a[0]);let o=e.textContent||e.innerText;return o=(o=o.replace(/\s+/g," ").trim()).replace(/<[^>]*>/g,"")})(e);if(o){u=o,m=(m=new TextEncoder).encode(u),u=await crypto.subtle.digest("SHA-256",m);var i=await(m=Array.from(new Uint8Array(u))).map(e=>e.toString(16).padStart(2,"0")).join(""),n=((e,t)=>{try{var a=localStorage.getItem("bellaaiPageSummary");if(a){var{url:o,hash:i,summary:n,timestamp:r}=JSON.parse(a);if(o===e&&i===t&&Date.now()-r<36e5)return n}}catch(e){console.error("Error reading cached summary:",e)}return null})(window.location.href,i);if(n)return console.log("Using cached page summary"),{...n,navigationLinks:t};var r={title:document.title,url:window.location.href,description:document.querySelector('meta[name="description"]')?.getAttribute("content")||"",type:a,dealer:x.dealer,navigationLinks:t},l=new URLSearchParams({content:o,metadata:JSON.stringify(r)}),s=await fetch("https://automation.cloudcovehosting.com/webhook/pagecontext?"+l.toString(),{method:"GET",headers:{"Content-Type":"application/json",Origin:window.location.origin}});if(s.ok){var d=await s.text();if(d){var c=window.location.href,p=i,h=d;try{var g={url:c,hash:p,summary:h,timestamp:Date.now()};localStorage.setItem("bellaaiPageSummary",JSON.stringify(g))}catch(e){console.error("Error caching summary:",e)}return{summary:d,navigationLinks:t}}console.warn("Empty response from page context webhook")}else console.warn("Failed to generate page summary:",s.status,s.statusText)}else console.log("No text content found in main content")}else console.log("No main content found on page");return null}catch(e){return console.error("Error generating page summary:",e),null}var u,m,y}function T(){E&&clearTimeout(E),E=setTimeout(async()=>{A=await B()},1e3)}document.addEventListener("DOMContentLoaded",T);const L=window.location.href;function z(){["Hi, I'm Bella! I'm a product specialist here to help guide you through our site today.",`We do things a little bit differently here at ${x.dealer.name||"[DealerName]"} and our customers really seem to appreciate it.`,"First let me ask, what brings you here today so I can help guide you to the right department?"].forEach((t,e)=>{setTimeout(()=>{var e=document.createElement("div");e.className="chat-message bot",e.innerHTML=u(t),k.appendChild(e),k.scrollTop=k.scrollHeight,b()},1e3*e)})}new MutationObserver(()=>{var e=window.location.href;e!==L&&(L=e,T())}).observe(document,{subtree:!0,childList:!0});let N=null;function D(){N&&(s.appendChild(d),N.remove(),N=null),d.classList.remove("overtake-modal"),d.style.position="",d.style.left="",d.style.top="",d.style.transform="",d.style.zIndex="",d.style.width="",d.style.height="",d.style.maxHeight="",d.style.borderRadius="",d.style.boxShadow="",d.style.opacity="",d.style.background="",d.style.display="",d.style.flexDirection="",d.style.padding="",document.body.style.overflow="",U()}function R(){H(),r=!0,d.classList.add("open"),c.classList.add("hidden"),window.innerWidth<=600&&(document.body.style.overflow="hidden"),k.scrollTop=k.scrollHeight,v(),clearTimeout(n)}function U(){d.classList.remove("open"),c.classList.remove("hidden"),window.innerWidth<=600&&(document.body.style.overflow="")}function O(){let t=d.querySelector(".chat-input");if(t){t.innerHTML="";let o=document.createElement("button");o.type="button",o.title="Transfer to Phone",o.id="bellaai-voice-button",o.innerHTML=`
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
          </svg>
        `,o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center",o.style.background="linear-gradient(135deg, var(--chat--color-primary) 0%, var(--chat--color-secondary) 100%)",o.style.color="white",o.style.border="none",o.style.borderRadius="8px",o.style.padding="0 12px",o.style.cursor="pointer",o.style.fontWeight="500",o.style.fontSize="16px",o.style.height="40px",o.style.minWidth="40px",o.style.marginRight="8px",o.onclick=function(e){e.stopPropagation();e=document.getElementById("bellaai-voice-tooltip");if(e)e.remove();else{let a=document.createElement("div");a.id="bellaai-voice-tooltip",a.style.position="absolute",a.style.bottom="60px",a.style.left="0",a.style.background="white",a.style.boxShadow="0 2px 12px rgba(0,0,0,0.15)",a.style.borderRadius="8px",a.style.padding="10px",a.style.zIndex="9999",a.style.width="200px",a.style.boxSizing="border-box";e=document.createElement("style");e.textContent=`
            #bellaai-voice-tooltip::after {
              content: '';
              position: absolute;
              bottom: -10px;
              left: 15px;
              margin-left: -10px;
              border-width: 10px 10px 0;
              border-style: solid;
              border-color: white transparent transparent transparent;
              filter: drop-shadow(0 2px 2px rgba(0,0,0,0.1));
            }
          `,document.head.appendChild(e),a.innerHTML=`
            <div style="font-size:0.9rem;font-weight:600;margin-bottom:8px;color:#333;">Transfer to Phone</div>
            <div id="bellaai-phone-input-container" style="width:100%;box-sizing:border-box;">
              <input type="tel" id="bellaai-phone-input" placeholder="Your phone number" style="width:100%;padding:8px;border-radius:4px;border:1px solid #ccc;margin-bottom:6px;font-size:0.85rem;box-sizing:border-box;">
              <button id="bellaai-start-call" style="width:100%;padding:8px;border-radius:4px;background:#003f72;color:#fff;font-weight:500;font-size:0.85rem;border:none;cursor:pointer;box-sizing:border-box;">Start Call</button>
            </div>
          `,t.style.position="relative",t.appendChild(a),document.addEventListener("click",function e(t){a.contains(t.target)||t.target===o||(a.remove(),document.removeEventListener("click",e))}),document.getElementById("bellaai-start-call").onclick=async function(){var t=document.getElementById("bellaai-phone-input").value.trim();if(t)try{a.remove(),await _("phone",t);var e=document.createElement("div");e.className="chat-message bot",e.innerHTML=u("I'm calling your phone now. Please answer to continue our conversation."),k.appendChild(e),k.scrollTop=k.scrollHeight}catch(e){console.error("Error initiating phone call:",e);t=document.createElement("div");t.className="chat-message bot",t.innerHTML=u("I couldn't connect to your phone. Please check the number and try again."),k.appendChild(t),k.scrollTop=k.scrollHeight}}}};var e=document.createElement("textarea"),a=(e.placeholder="Type your message here...",e.rows=1,e.style.resize="none",e.style.flex="1",e.style.marginRight="8px",e.className=h.className,document.createElement("button"));a.type="submit",a.innerHTML='<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>',a.style.display="flex",a.style.alignItems="center",a.style.justifyContent="center",a.style.background="linear-gradient(135deg, var(--chat--color-primary) 0%, var(--chat--color-secondary) 100%)",a.style.color="white",a.style.border="none",a.style.borderRadius="8px",a.style.padding="0 18px",a.style.cursor="pointer",a.style.fontWeight="500",a.style.fontSize="16px",a.style.height="40px",a.style.minWidth="40px",t.appendChild(o),t.appendChild(e),t.appendChild(a),a.addEventListener("click",S),e.addEventListener("keypress",function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),S())}),e.addEventListener("input",function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"}),window.bellaaiTextarea=e}}function M(){try{var e,t=localStorage.getItem("bellaaiChatSession");return t?(e=JSON.parse(t)).messages&&Array.isArray(e.messages)?e.messages.map(e=>({role:"user"===e.type?"user":"assistant",content:"user"===e.type?e.content:e.content.replace(/<[^>]*>/g,""),timestamp:(new Date).toISOString()})):[]:[]}catch(e){return console.error("Failed to parse chat history",e),[]}}async function _(e,t){var a=M(),o=x.dealer;console.log("[BellaAI] Initiating voice call with dealer info:",o);let i="";try{var n=x.webhook.url.match(/\/webhook\/([^\/]+)/);n&&n[1]&&(i=n[1])}catch(e){console.error("[BellaAI] Error extracting chatbot ID:",e)}let r={};if("phone_raw"===e)r={type:e,phone:t,chatbotId:i,dealerInfo:o};else if(r={type:e,chatHistory:a,dealerInfo:o,sessionId:y,chatbotId:i},"phone"===e){if(!t)throw new Error("Phone number required for phone call");r.phone=t}try{console.log("[BellaAI] Sending voice call payload:",JSON.stringify(r));var l,s,d=await fetch("https://automation.cloudcovehosting.com/webhook/voice-call",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(d.ok)return(s=d.headers.get("content-type"))&&s.includes("application/json")?d.json():{status:"success",message:await d.text(),callDetails:{phone:t,callId:"unknown",status:"connecting"}};throw l=await d.text(),new Error("Failed to initiate call: "+l)}catch(e){throw console.error("Error in initiateVoiceCall:",e),e}}(l=document.createElement("style")).textContent=`
        @keyframes bellaai-fadein {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        .bellaai-overtake-overlay {
          animation: bellaai-fadein 0.4s forwards;
        }
        .overtake-modal .brand-header {
          padding-bottom: 12px;
          border-bottom: 1px solid #f0f0f0;
          margin-bottom: 12px;
        }
        .overtake-modal .brand-header img {
          width: 40px;
          height: 40px;
          margin-right: 10px;
        }
        .overtake-modal .brand-header span {
          font-size: 22px;
          font-weight: 600;
        }
        .overtake-modal .close-button {
          position: absolute;
          right: 18px;
          top: 18px;
          background: none;
          border: none;
          cursor: pointer;
          font-size: 28px;
          color: #888;
          opacity: 0.7;
          z-index: 2;
          transition: opacity 0.2s;
        }
        .overtake-modal .close-button:hover {
          opacity: 1;
        }
        .overtake-modal .chat-messages {
          display: flex;
          flex-direction: column;
          flex: 1 1 0%;
          overflow-y: auto;
          padding: 10px 0 10px 0;
          margin-bottom: 10px;
          background: none;
          min-height: 400px;
        }
        .overtake-modal .chat-input {
          padding: 0;
          border-top: 1px solid #f0f0f0;
          margin-top: 10px;
          background: none;
          display: flex;
          align-items: center;
        }
        .overtake-modal .chat-input textarea {
          flex: 1 !important;
          padding: 12px !important;
          border: 1px solid rgba(133, 79, 255, 0.2) !important;
          border-radius: 8px !important;
          resize: none !important;
          font-family: inherit !important;
          font-size: 14px !important;
          height: auto !important;
          min-height: 40px !important;
          max-height: 120px !important;
          width: auto !important;
          box-sizing: border-box !important;
          margin-right: 8px;
        }
        .overtake-modal .chat-input button[type="submit"] {
          background: linear-gradient(135deg, var(--chat--color-primary) 0%, var(--chat--color-secondary) 100%);
          color: #fff;
          border: none;
          border-radius: 8px;
          padding: 0 18px;
          cursor: pointer;
          font-weight: 500;
          font-size: 16px;
          height: 40px;
          min-width: 40px;
          display: flex;
          align-items: center;
          justify-content: center;
        }
        .overtake-modal .chat-input button[type="submit"] svg {
          fill: #fff;
          stroke: #fff;
        }
        .overtake-modal .chat-message.user {
          background: linear-gradient(135deg, var(--chat--color-primary) 0%, var(--chat--color-secondary) 100%);
          color: #fff;
          align-self: flex-end;
          text-align: right;
          margin-left: auto;
          margin-right: 0;
          box-shadow: 0 4px 12px rgba(133, 79, 255, 0.2);
          border-radius: 12px;
          padding: 12px 16px;
          margin: 8px 0;
          max-width: 80%;
          word-wrap: break-word;
          font-size: 14px;
          line-height: 1.5;
        }
        .overtake-modal #bellaai-voice-button {
          background: linear-gradient(135deg, var(--chat--color-primary) 0%, var(--chat--color-secondary) 100%);
        }
        @media (max-width: 600px) {
          .overtake-modal {
            padding: 0 !important;
          }
          .overtake-modal .brand-header img {
            width: 32px;
            height: 32px;
          }
          .overtake-modal .brand-header span {
            font-size: 18px;
          }
          .overtake-modal .chat-messages {
            min-height: 200px;
          }
        }
        .chat-container.overtake-modal {
          height: 100% !important;
        }
        .chat-interface {
          height: 100%;
          display: flex;
          flex-direction: column;
          justify-content: space-around;
        }
        .overtake-modal {
          height: 60vh;
          max-height: 60vh;
          display: flex;
          flex-direction: column;
        }
        .overtake-modal .chat-messages {
          flex: 1 1 0%;
          overflow-y: auto;
          min-height: 0;
        }
        @media (max-width: 600px) {
          .overtake-modal {
            height: 85vh !important;
            max-height: 85vh !important;
          }
        }
      `,document.head.appendChild(l),(e=document.createElement("style")).textContent=`
        .overtake-modal {
          width: 800px !important;
          max-width: 95vw;
        }
        @media (max-width: 900px) {
          .overtake-modal {
            width: 95vw !important;
          }
        }
        @media (max-width: 600px) {
          .overtake-modal {
            width: 95vw !important;
            height: 85vh !important;
            max-height: 85vh !important;
            border-radius: 12px !important;
            padding: 16px 6px 10px 6px !important;
          }
        }
      `,document.head.appendChild(e),l=x.overtakePath||"/",!0!==x.overtake||window.location.pathname!==l||localStorage.getItem("bellaaiOvertakeShown")||setTimeout(()=>{(N=document.createElement("div")).className="bellaai-overtake-overlay",N.style.position="fixed",N.style.inset="0",N.style.background="rgba(0,0,0,0.6)",N.style.zIndex="2147483646",N.style.display="flex",N.style.alignItems="center",N.style.justifyContent="center",N.style.transition="opacity 0.4s",N.style.opacity="0",N.style.animation="bellaai-fadein 0.4s forwards",d.classList.add("overtake-modal"),d.style.position="relative",d.style.left="",d.style.top="",d.style.transform="",d.style.zIndex="2147483647",d.style.width="800px",d.style.height="auto",d.style.maxHeight="90vh",d.style.borderRadius="18px",d.style.boxShadow="0 8px 32px rgba(0,0,0,0.25)",d.style.opacity="0",d.style.background="#fff",d.style.display="flex",d.style.flexDirection="column",d.style.padding="32px 28px 20px 28px",d.style.transition="opacity 0.4s",d.style.setProperty("--chat--color-primary",x.style.primaryColor),d.style.setProperty("--chat--color-secondary",x.style.secondaryColor),setTimeout(()=>{d.style.opacity="1"},50),window.innerWidth<=900&&(d.style.width="95vw"),window.innerWidth<=600&&(d.style.width="95vw",d.style.height="85vh",d.style.maxHeight="85vh",d.style.borderRadius="12px",d.style.padding="16px 6px 10px 6px"),c.classList.add("hidden"),document.body.appendChild(N),N.appendChild(d),document.body.style.overflow="hidden",localStorage.setItem("bellaaiOvertakeShown","1"),R()},400),window.BellaAIChatWidgetChatInitialized||(window.BellaAIChatWidgetChatInitialized=!0,i()||(w=!1,y=o(),z(),B()),b(),k.scrollTop=k.scrollHeight,v(),clearTimeout(n),c.addEventListener("click",function(){R()}),C.addEventListener("click",function(){U(),a(t=!0),window.innerWidth<=600&&(document.body.style.overflow="")}),I.addEventListener("click",S),h.addEventListener("keypress",function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),S())}),h.addEventListener("input",function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"}),window.addEventListener("resize",function(){window.innerWidth<=600?d.classList.contains("open")&&(document.body.style.overflow="hidden"):document.body.style.overflow=""})),O(),(e=document.createElement("style")).textContent=`
        .chat-message.user {
          background: linear-gradient(135deg, var(--chat--color-primary) 0%, var(--chat--color-secondary) 100%);
          color: white;
          align-self: flex-end;
          box-shadow: 0 4px 12px rgba(133, 79, 255, 0.2);
          border-radius: 12px;
          padding: 12px 16px;
          margin: 8px 0;
          max-width: 80%;
          word-wrap: break-word;
          font-size: 14px;
          line-height: 1.5;
        }
        .chat-message.bot {
          background: #ffffff;
          border: 1px solid rgba(133, 79, 255, 0.2);
          color: #333;
          align-self: flex-start;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
          border-radius: 12px;
          padding: 12px 16px;
          margin: 8px 0;
          max-width: 80%;
          word-wrap: break-word;
          font-size: 14px;
          line-height: 1.5;
        }
        .chat-input {
          display: flex;
          align-items: center;
          gap: 8px;
          padding: 0;
          border-top: 1px solid #f0f0f0;
          margin-top: 10px;
          background: none;
        }
        .chat-input textarea {
          flex: 1 !important;
          padding: 12px !important;
          border: 1px solid rgba(133, 79, 255, 0.2) !important;
          border-radius: 8px !important;
          resize: none !important;
          font-family: inherit !important;
          font-size: 14px !important;
          height: auto !important;
          min-height: 40px !important;
          max-height: 120px !important;
          width: auto !important;
          box-sizing: border-box !important;
          margin-right: 8px;
        }
        .chat-input button[type="submit"] {
          background: linear-gradient(135deg, var(--chat--color-primary) 0%, var(--chat--color-secondary) 100%);
          color: white;
          border: none;
          border-radius: 8px;
          padding: 0 18px;
          cursor: pointer;
          font-weight: 500;
          font-size: 16px;
          height: 40px;
          min-width: 40px;
          display: flex;
          align-items: center;
          justify-content: center;
        }
      `,document.head.appendChild(e),document.addEventListener("keydown",function(e){"Escape"===e.key&&(N?D():d.classList.contains("open")&&U())})})();