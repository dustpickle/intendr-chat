window.BellaAIVoiceChatAudio={currentSource:null,isPlaying:!1,stop:function(){if(this.currentSource){try{this.currentSource.stop(),this.currentSource.disconnect()}catch(e){console.error("[BellaAI] Error stopping audio:",e)}this.currentSource=null,this.isPlaying=!1}},play:function(e){this.stop(),this.currentSource=e,this.isPlaying=!0,e.onended=()=>{this.isPlaying=!1,this.currentSource=null},e.start(0)}},window.BellaAITranscriptTracking={lastUserTranscriptId:null,lastAgentResponseId:null,currentConversationId:null,reset:function(){this.lastUserTranscriptId=null,this.lastAgentResponseId=null,this.currentConversationId=null}},(()=>{console.log("ChatVersion:","2.0");let h="";(async()=>{try{var e=await(await fetch("https://api.ipify.org?format=json")).json();h=e.ip,console.log("User IP collected for chat")}catch(e){console.error("Error fetching IP:",e),h="unknown"}})();var e={webhook:{url:"",route:""},branding:{logo:"https://cdn-icons-png.flaticon.com/512/5962/5962463.png",name:"Bella : Product Specialist",welcomeText:""},style:{primaryColor:"#003f72",secondaryColor:"#003f72",position:"right",backgroundColor:"#ffffff",fontColor:"#333333"},dealer:{name:"",phone:"",website:"",searchPage:"",provider:""},overtake:!1};let f=window.ChatWidgetConfig?{webhook:{...e.webhook,...window.ChatWidgetConfig.webhook},branding:{...e.branding,...window.ChatWidgetConfig.branding},style:{...e.style,...window.ChatWidgetConfig.style},dealer:{...e.dealer,...window.ChatWidgetConfig.dealer},overtake:window.ChatWidgetConfig.overtake||!1,overtakePath:window.ChatWidgetConfig.overtakePath||"/"}:e;if(window.BellaAIChatWidgetInitialized)return;let t=!(window.BellaAIChatWidgetInitialized=!0);function o(e){try{var t={manuallyClosed:e,timestamp:(new Date).getTime()};localStorage.setItem("bellaaiChatState",JSON.stringify(t))}catch(e){console.error("Error saving chat state:",e)}}function a(){return"undefined"!=typeof crypto&&"function"==typeof crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function S(e){var t;return e?(t=/<[a-z][\s\S]*>/i.test(e),e=e.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank">$1</a>'),(e=(e=(e=t?e:e.replace(/(https?:\/\/[^\s<]+)(?![^<]*>)/g,'<a href="$1" target="_blank">Visit Website</a>')).replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>")).replace(/\*([^*]+)\*/g,"<em>$1</em>")).replace(/\n/g,"<br>")):""}function g(){var e=document.getElementById("thinking-animation");e&&e.remove()}window.initialUtmParameters=(e=>{let o={};try{var a=new URL(e);let t=new URLSearchParams(a.search);var n,i,r=["utm_source","utm_medium","utm_campaign","utm_term","utm_content"];r.forEach(function(e){t.has(e)&&(o[e]=t.get(e))});for([n,i]of t.entries())n.startsWith("utm_")&&!r.includes(n)&&(o[n]=i)}catch(e){console.error("Error extracting UTM parameters:",e)}return o})(window.location.href),console.log("Initial UTM Parameters:",window.initialUtmParameters);let u="";function E(){if(u)try{var e={sessionId:u,messages:Array.from(A.children).filter(function(e){return e.classList.contains("chat-message")}).map(function(e){return{type:e.classList.contains("user")?"user":"bot",content:e.classList.contains("user")?e.textContent:e.innerHTML}}),inactivityMessageSent:y,promptBubbleShown:r,timestamp:(new Date).getTime(),utmParameters:window.initialUtmParameters||{}};localStorage.setItem("bellaaiChatSession",JSON.stringify(e))}catch(e){console.error("Error saving chat session:",e)}}function n(){try{var e=localStorage.getItem("bellaaiChatSession");if(e){var t=JSON.parse(e),o=(new Date).getTime()-t.timestamp;if(o<864e5)return A.innerHTML="",u=t.sessionId,t.inactivityMessageSent&&(y=!0),t.promptBubbleShown&&(r=!0),t.utmParameters&&(window.initialUtmParameters=t.utmParameters),t.messages&&0<t.messages.length&&t.messages.forEach(function(e){var t=document.createElement("div");t.className="chat-message "+e.type,"user"===e.type?t.textContent=e.content:t.innerHTML=e.content,A.appendChild(t)}),!0;localStorage.removeItem("bellaaiChatSession")}}catch(e){console.error("Error loading saved chat session:",e),localStorage.removeItem("bellaaiChatSession")}return!1}let m,P=12e4,y=!1;function x(){clearTimeout(m),y||(m=setTimeout(function(){var e;T.classList.contains("open")&&u&&((e=document.createElement("div")).className="chat-message bot",e.innerHTML=S("Do you have any questions I can help with?"),A.appendChild(e),A.scrollTop=A.scrollHeight,y=!0,E())},P))}let i,r=!1;function R(){var e=document.getElementById("prompt-bubble");e&&e.remove()}var l,e=`
      .bellaai-chat-widget {
        --chat--color-primary: ${f.style.primaryColor};
        --chat--color-secondary: ${f.style.secondaryColor};
        font-family: 'Geist Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      }
      .bellaai-chat-widget .chat-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 2147483647;
        width: 380px;
        height: 600px;
        background: #ffffff;
        border-radius: 12px !important;
        box-shadow: 0 8px 32px rgba(133, 79, 255, 0.15);
        border: 1px solid rgba(133, 79, 255, 0.2);
        overflow: hidden;
        opacity: 0;
        transform-origin: bottom right;
        transform: scale(0);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        pointer-events: none;
        display: flex;
        flex-direction: column;
        visibility: hidden;
      }
      @media screen and (max-width: 600px) {
        .bellaai-chat-widget .chat-container {
          width: 100%;
          height: 100%;
          bottom: 0;
          right: 0;
          border-radius: 0;
          box-shadow: none;
        }
        .bellaai-chat-widget .chat-container.position-left {
          left: 0;
        }
      }
      .bellaai-chat-widget .chat-container.position-left {
        right: auto;
        left: 20px;
        transform-origin: bottom left;
      }
      .bellaai-chat-widget .chat-container.open {
        opacity: 1;
        transform: scale(1);
        pointer-events: all;
        visibility: visible;
      }
      .bellaai-chat-widget .brand-header {
        padding: 16px;
        display: flex;
        align-items: center;
        gap: 12px;
        border-bottom: 1px solid rgba(133, 79, 255, 0.1);
        position: relative;
      }
      .bellaai-chat-widget .close-button {
        position: absolute;
        right: 16px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        cursor: pointer;
        font-size: 20px;
        opacity: 0.6;
      }
      .bellaai-chat-widget .brand-header img {
        width: 32px;
        height: 32px;
      }
      .bellaai-chat-widget .brand-header span {
        font-size: 18px;
        font-weight: 500;
      }
      .bellaai-chat-widget .chat-interface {
        display: flex;
        flex-direction: column;
        height: 100%;
      }
      .bellaai-chat-widget .chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
        display: flex;
        flex-direction: column;
      }
      .bellaai-chat-widget .chat-message {
        padding: 12px 16px;
        margin: 8px 0;
        border-radius: 12px;
        max-width: 80%;
        word-wrap: break-word;
        font-size: 14px;
        line-height: 1.5;
      }
      .bellaai-chat-widget .chat-message.user {
        background: linear-gradient(135deg, var(--chat--color-primary) 0%, var(--chat--color-secondary) 100%);
        color: #fff;
        align-self: flex-end;
        box-shadow: 0 4px 12px rgba(133, 79, 255, 0.2);
        border-radius: 12px;
        padding: 12px 16px;
        margin: 8px 0;
        max-width: 80%;
        word-wrap: break-word;
        font-size: 14px;
        line-height: 1.5;
      }
      .bellaai-chat-widget .chat-message.bot {
        background: #ffffff;
        border: 1px solid rgba(133, 79, 255, 0.2);
        color: #333;
        align-self: flex-start;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      }
      .bellaai-chat-widget .chat-message.bot a {
        color: var(--chat--color-primary);
        text-decoration: none;
        font-weight: 500;
      }
      .bellaai-chat-widget .chat-message.bot a:hover {
        text-decoration: underline;
      }
      .bellaai-chat-widget .chat-message.bot a:hover {
        text-decoration: underline;
      }
      .bellaai-chat-widget .chat-input {
        padding: 16px;
        border-top: 1px solid rgba(133, 79, 255, 0.1);
        display: flex;
        gap: 8px;
      }
      .bellaai-chat-widget .chat-input textarea {
        flex: 1 !important;
        padding: 12px !important;
        border: 1px solid rgba(133, 79, 255, 0.2) !important;
        border-radius: 8px !important;
        resize: none !important;
        font-family: inherit !important;
        font-size: 14px !important;
        height: auto !important;
        min-height: 40px !important;
        max-height: 120px !important;
        width: auto !important;
        box-sizing: border-box !important;
      }
      .bellaai-chat-widget .chat-input button {
        background: linear-gradient(135deg, var(--chat--color-primary) 0%, var(--chat--color-secondary) 100%);
        color: #fff;
        border: none;
        border-radius: 8px;
        padding: 0 18px;
        cursor: pointer;
        font-weight: 500;
        font-size: 16px;
        height: 40px;
        min-width: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .bellaai-chat-widget .chat-input button svg {
        fill: #fff;
        stroke: #fff;
      }
    .bellaai-chat-widget .chat-toggle {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px 20px;
      background: linear-gradient(135deg, var(--chat--color-primary) 0%, var(--chat--color-secondary) 100%);
      color: white;
      border: none;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(133, 79, 255, 0.3);
      z-index: 2147483647;
      border-radius: 30px !important;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      opacity: 1;
      transform: scale(1);
    }
    
    .bellaai-chat-widget .chat-toggle.hidden {
      opacity: 0;
      transform: scale(0.8);
      pointer-events: none;
    }
    
    .bellaai-chat-widget .chat-toggle-content {
      display: flex;
      align-items: center;
      gap: 12px;
      position: relative;
    }
    
    .bellaai-chat-widget .chat-toggle svg {
      width: 24px;
      height: 24px;
      fill: currentColor;
      color: white;
    }
    
    .bellaai-chat-widget .chat-toggle-text {
      font-size: 16px;
      font-weight: 500;
      white-space: nowrap;
      line-height: 24px;
    }
    
    .bellaai-chat-widget .online-indicator {
      position: absolute;
      top: -20px;
      right: -4px;
      width: 12px;
      height: 12px;
      background-color: #22c55e;
      border-radius: 50%;
      border: 2px solid white;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4);
      }
      70% {
        box-shadow: 0 0 0 10px rgba(34, 197, 94, 0);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(34, 197, 94, 0);
      }
    }
    
    /* Update mobile styles for online indicator */
    @media screen and (max-width: 600px) {
      .bellaai-chat-widget .chat-toggle {
        width: 60px;
        height: 60px;
        padding: 0;
        justify-content: center;
      }
    
      .bellaai-chat-widget .chat-toggle-text {
        display: none;
      }
      
      .bellaai-chat-widget .online-indicator {
        top: -20px;
        right: -4px;
      }
    }
    
        .bellaai-chat-widget .chat-toggle.position-left {
          right: auto;
          left: 20px;
        }
        .bellaai-chat-widget .chat-toggle svg {
          width: 24px;
          height: 24px;
          fill: currentColor;
        }
        .bellaai-chat-widget .thinking {
          display: flex;
          align-items: center;
          padding: 12px 16px;
          margin: 8px 0;
          border-radius: 12px;
          max-width: 80%;
          align-self: flex-start;
          background: #fff;
          border: 1px solid rgba(133, 79, 255, 0.2);
          gap: 8px;
        }
        .bellaai-chat-widget .thinking span {
          color: #666;
          font-size: 14px;
        }
        .bellaai-chat-widget .dots {
          display: flex;
          gap: 2px;
        }
        .bellaai-chat-widget .dot {
          height: 8px;
          width: 8px;
          background-color: var(--chat--color-primary);
          border-radius: 50%;
          display: inline-block;
          opacity: 0.4;
          animation: dot-typing 1.4s infinite ease-in-out;
        }
        .bellaai-chat-widget .dot:nth-child(1) { animation-delay: 0s; }
        .bellaai-chat-widget .dot:nth-child(2) { animation-delay: 0.2s; }
        .bellaai-chat-widget .dot:nth-child(3) { animation-delay: 0.4s; }
        /* Prompt bubble styles */
        .bellaai-chat-widget .prompt-bubble {
          position: absolute;
          bottom: 90px;
          right: 10px;
          background: white;
          color: var(--chat--color-primary);
          padding: 8px 14px;
          border-radius: 18px;
          font-size: 14px;
          font-weight: 500;
          box-shadow: 0 2px 12px rgba(0, 0, 0, 0.15);
          cursor: pointer;
          z-index: 2147483646;
          border: 1px solid rgba(133, 79, 255, 0.2);
          animation: bounce-in 0.5s;
        }
        /* Position the prompt bubble on the left if chat is on the left */
        .bellaai-chat-widget .chat-toggle.position-left + .prompt-bubble {
          right: auto;
          left: 10px;
        }
        @keyframes bounce-in {
          0% { transform: scale(0.5); opacity: 0; }
          50% { transform: scale(1.05); opacity: 0.9; }
          100% { transform: scale(1); opacity: 1; }
        }
        @keyframes dot-typing {
          0%, 60%, 100% { opacity: 0.4; transform: scale(1); }
          30% { opacity: 1; transform: scale(1.2); }
        }
      `;(l=document.createElement("style")).textContent=e,document.head.appendChild(l);let s=document.createElement("div"),T=(s.className="bellaai-chat-widget",document.createElement("div")),c=(T.className="chat-container"+("left"===f.style.position?" position-left":""),e=`
        <div class="chat-interface">
          <div class="brand-header">
            <img src="${f.branding.logo}" alt="${f.branding.name}">
            <span>${f.branding.name}</span>
            <button class="close-button">×</button>
          </div>
          <div class="chat-messages"></div>
          <div class="chat-input">
            <textarea placeholder="Type your message here..." rows="1"></textarea>
            <button type="submit">Send</button>
          </div>
        </div>
      `,T.innerHTML=e,document.createElement("button")),A=(c.className="chat-toggle"+("left"===f.style.position?" position-left":""),c.innerHTML=`
        <div class="chat-toggle-content">
          <div class="online-indicator"></div>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z" fill="currentColor"/>
          </svg>
          <span class="chat-toggle-text">Chat with us!</span>
        </div>
      `,s.appendChild(T),s.appendChild(c),document.body.appendChild(s),T.querySelector(".chat-interface"),T.querySelector(".chat-messages"));const B=T.querySelector("textarea"),L=T.querySelector('button[type="submit"]');let d=T.querySelector(".close-button");function _(){var e,t=window.bellaaiTextarea||B||document.querySelector(".chat-input textarea");t?(e=t.value.trim())&&(["close","close chat","exit","quit","dismiss"].includes(e.toLowerCase())?((C?z:N)(),t.value=""):((async e=>{if(e.trim()){var t=document.createElement("div");t.className="chat-message user",t.textContent=e,A.appendChild(t),A.scrollTop=A.scrollHeight,(()=>{var e=document.createElement("div");e.className="thinking",e.innerHTML=`
        <span>Bella is typing</span>
        <div class="dots">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        </div>
      `,e.id="thinking-animation",A.appendChild(e),A.scrollTop=A.scrollHeight})();try{var o=b||await w(),a={chatInput:e,sessionId:u,metadata:{dealer:f.dealer,pageContext:o,utmParameters:window.initialUtmParameters||{},userIP:h}},n=await fetch(f.webhook.url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!n.ok)throw new Error("Failed to send message");let t="";var i=await n.text();try{var r=JSON.parse(i);Array.isArray(r)&&0<r.length&&r[0].output?t=r[0].output:r&&"object"==typeof r?t=r.output||r.response||r.message||"":"string"==typeof r&&(t=r)}catch(e){t=i}t&&""!==t.trim()||(t="I received your message, but I'm having trouble generating a response."),g();var l=t.match(/\[REDIRECT\](.*?)\[\/REDIRECT\]/);if(l&&l[1]){let e=(t=>{try{var e=new URL(t),o=new URLSearchParams(e.search);return o.set("utm_source","BellaAI"),o.set("utm_medium","chat"),o.set("utm_campaign","Drivonic-MarketBuilder-AIChat"),e.search=o.toString(),e.toString()}catch(e){return console.error("Error appending UTM parameters to URL:",e),t}})(l[1].trim());var s=document.createElement("div"),c=(s.className="chat-message bot",s.innerHTML=S("Redirecting you now..."),A.appendChild(s),document.createElement("div"));c.className="chat-message bot",c.innerHTML=S("Our product specialists are ready to help you explore your options and answer any questions. What's the best phone number to reach you at?"),A.appendChild(c),A.scrollTop=A.scrollHeight,E(),void setTimeout(()=>{window.location.href=e},2e3)}else{var d,p=t.replace(/\[REDIRECT\][\s\S]*?\[\/REDIRECT\]/g,"").trim();p&&((d=document.createElement("div")).className="chat-message bot",d.innerHTML=S(p),A.appendChild(d),A.scrollTop=A.scrollHeight),E(),y=!1,clearTimeout(m),x()}}catch(e){console.error("Error sending message:",e),g();t=document.createElement("div");t.className="chat-message bot",t.innerHTML=S("I apologize, but I'm having trouble connecting right now. Please try again in a moment."),A.appendChild(t),A.scrollTop=A.scrollHeight}}})(e),t.value="",t.style.height="auto")):console.error("[BellaAI] No textarea found for message sending")}c.addEventListener("click",function(){T.classList.contains("open")||(T.classList.add("open"),c.classList.add("hidden"),window.innerWidth<=600&&(document.body.style.overflow="hidden"),A.innerHTML="",n()||(y=!1,u=a(),w().then(()=>{I()})),E(),A.scrollTop=A.scrollHeight,x(),clearTimeout(i))}),d.addEventListener("click",function(){(C?z:N)(),o(t=!0),window.innerWidth<=600&&(document.body.style.overflow="")}),B.addEventListener("input",function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"}),L.addEventListener("click",_),B.addEventListener("keypress",function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),_())}),window.addEventListener("resize",function(){window.innerWidth<=600?T.classList.contains("open")&&(document.body.style.overflow="hidden"):document.body.style.overflow=""});let b=null,p=null;async function w(){try{var e=document.querySelector("main, #main, .main-content, .content");if(e){var t=(()=>{if(e=localStorage.getItem("bellai_nav_links"))return JSON.parse(e);let o=new Set;function t(e){e&&e.querySelectorAll("a[href]").forEach(e=>{var t=e.getAttribute("href"),e=e.textContent.trim();t&&!t.startsWith("#")&&!t.startsWith("javascript:")&&e&&(t=new URL(t,window.location.origin).href,o.add(JSON.stringify({text:e,url:t})))})}var e=document.querySelector("nav"),a=document.querySelector("header"),e=(e&&t(e),a&&t(a),0===o.size&&document.querySelectorAll('[class*="nav"]').forEach(e=>t(e)),Array.from(o).map(e=>JSON.parse(e)));return localStorage.setItem("bellai_nav_links",JSON.stringify(e)),e})(),o=(y=window.location.pathname.toLowerCase()).includes("/new-vehicles/")||y.includes("/used-vehicles/")?"inventory":y.includes("/finance")?"finance":y.includes("/service")?"service":y.includes("/parts")?"parts":y.includes("/about")?"about":y.includes("/contact")?"contact":"/"===y||"/index.html"===y?"home":"other",a=(e=>{if(!e)return"";for(var t=(e=e.cloneNode(!0)).getElementsByTagName("script");0<t.length;)t[0].parentNode.removeChild(t[0]);for(var o=e.getElementsByTagName("style");0<o.length;)o[0].parentNode.removeChild(o[0]);let a=e.textContent||e.innerText;return a=(a=a.replace(/\s+/g," ").trim()).replace(/<[^>]*>/g,"")})(e);if(a){u=a,m=(m=new TextEncoder).encode(u),u=await crypto.subtle.digest("SHA-256",m);var n=await(m=Array.from(new Uint8Array(u))).map(e=>e.toString(16).padStart(2,"0")).join(""),i=((e,t)=>{try{var o=localStorage.getItem("bellaaiPageSummary");if(o){var{url:a,hash:n,summary:i,timestamp:r}=JSON.parse(o);if(a===e&&n===t&&Date.now()-r<36e5)return i}}catch(e){console.error("Error reading cached summary:",e)}return null})(window.location.href,n);if(i)return console.log("Using cached page summary"),{...i,navigationLinks:t};var r={title:document.title,url:window.location.href,description:document.querySelector('meta[name="description"]')?.getAttribute("content")||"",type:o,dealer:f.dealer,navigationLinks:t},l=new URLSearchParams({content:a,metadata:JSON.stringify(r)}),s=await fetch("https://automation.cloudcovehosting.com/webhook/pagecontext?"+l.toString(),{method:"GET",headers:{"Content-Type":"application/json",Origin:window.location.origin}});if(s.ok){var c=await s.text();if(c){var d=window.location.href,p=n,h=c;try{var g={url:d,hash:p,summary:h,timestamp:Date.now()};localStorage.setItem("bellaaiPageSummary",JSON.stringify(g))}catch(e){console.error("Error caching summary:",e)}return{summary:c,navigationLinks:t}}console.warn("Empty response from page context webhook")}else console.warn("Failed to generate page summary:",s.status,s.statusText)}else console.log("No text content found in main content")}else console.log("No main content found on page");return null}catch(e){return console.error("Error generating page summary:",e),null}var u,m,y}function v(){p&&clearTimeout(p),p=setTimeout(async()=>{b=await w()},1e3)}document.addEventListener("DOMContentLoaded",v);const k=window.location.href;function I(){["Hi, I'm Bella! I'm a product specialist here to help guide you through our site today.",`We do things a little bit differently here at ${f.dealer.name||"[DealerName]"} and our customers really seem to appreciate it.`,"First let me ask, what brings you here today so I can help guide you to the right department?"].forEach((t,e)=>{setTimeout(()=>{var e=document.createElement("div");e.className="chat-message bot",e.innerHTML=S(t),A.appendChild(e),A.scrollTop=A.scrollHeight,E()},1e3*e)})}new MutationObserver(()=>{var e=window.location.href;e!==k&&(k=e,v())}).observe(document,{subtree:!0,childList:!0});let C=null;function z(){C&&(s.appendChild(T),C.remove(),C=null),T.classList.remove("overtake-modal"),T.style.position="",T.style.left="",T.style.top="",T.style.transform="",T.style.zIndex="",T.style.width="",T.style.height="",T.style.maxHeight="",T.style.borderRadius="",T.style.boxShadow="",T.style.opacity="",T.style.background="",T.style.display="",T.style.flexDirection="",T.style.padding="",document.body.style.overflow="",N()}function H(){R(),r=!0,T.classList.add("open"),c.classList.add("hidden"),window.innerWidth<=600&&(document.body.style.overflow="hidden"),A.scrollTop=A.scrollHeight,x(),clearTimeout(i)}function N(){T.classList.remove("open"),c.classList.remove("hidden"),window.innerWidth<=600&&(document.body.style.overflow="")}function M(){let t=T.querySelector(".chat-input");if(t){t.innerHTML="";let a=document.createElement("button");a.type="button",a.title="Transfer to Voice",a.id="bellaai-voice-button",a.innerHTML=`
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
            <line x1="12" y1="19" x2="12" y2="23"></line>
            <line x1="8" y1="23" x2="16" y2="23"></line>
          </svg>
          <span style="margin:0 2px;">/</span>
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
          </svg>
        `,a.style.display="flex",a.style.alignItems="center",a.style.justifyContent="center",a.style.background="linear-gradient(135deg, var(--chat--color-primary) 0%, var(--chat--color-secondary) 100%)",a.style.color="white",a.style.border="none",a.style.borderRadius="8px",a.style.padding="0 12px",a.style.cursor="pointer",a.style.fontWeight="500",a.style.fontSize="16px",a.style.height="40px",a.style.minWidth="40px",a.style.marginRight="8px",a.onclick=function(e){e.stopPropagation();e=document.getElementById("bellaai-voice-tooltip");if(e)e.remove();else{let o=document.createElement("div");o.id="bellaai-voice-tooltip",o.style.position="absolute",o.style.bottom="50px",o.style.left="0",o.style.background="white",o.style.boxShadow="0 2px 12px rgba(0,0,0,0.15)",o.style.borderRadius="8px",o.style.padding="10px",o.style.zIndex="9999",o.style.width="210px",o.innerHTML=`
            <div style="font-size:0.9rem;font-weight:600;margin-bottom:8px;color:#333;">Transfer to Voice</div>
            <button id="bellaai-browser-voice" style="width:100%;margin-bottom:6px;padding:8px;border-radius:4px;background:#003f72;color:#fff;font-weight:500;font-size:0.85rem;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:6px;">
                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                <line x1="12" y1="19" x2="12" y2="23"></line>
                <line x1="8" y1="23" x2="16" y2="23"></line>
              </svg>
              Start Voice Chat
            </button>
            <button id="bellaai-phone-voice" style="width:100%;padding:8px;border-radius:4px;background:#003f72;color:#fff;font-weight:500;font-size:0.85rem;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:6px;">
                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
              </svg>
              Call my Phone
            </button>
            <div id="bellaai-phone-input-container" style="display:none;margin-top:6px;">
              <input type="tel" id="bellaai-phone-input" placeholder="Your phone number" style="width:100%;padding:8px;border-radius:4px;border:1px solid #ccc;margin-bottom:6px;font-size:0.85rem;">
              <button id="bellaai-start-call" style="width:100%;padding:8px;border-radius:4px;background:#003f72;color:#fff;font-weight:500;font-size:0.85rem;border:none;cursor:pointer;">Start Call</button>
            </div>
          `,t.style.position="relative",t.appendChild(o),document.addEventListener("click",function e(t){o.contains(t.target)||t.target===a||(o.remove(),document.removeEventListener("click",e))}),document.getElementById("bellaai-browser-voice").onclick=async function(){o.remove();try{var t=await D("browser");if(!t.websocketUrl)throw new Error("Missing websocketUrl from server");O(t.websocketUrl)}catch(e){console.error("Error starting voice chat:",e);t=document.createElement("div");t.className="chat-message bot",t.innerHTML=S("I couldn't start the voice chat. Please try again later."),A.appendChild(t),A.scrollTop=A.scrollHeight}},document.getElementById("bellaai-phone-voice").onclick=function(){document.getElementById("bellaai-phone-input-container").style.display="block",document.getElementById("bellaai-browser-voice").style.display="none",document.getElementById("bellaai-phone-voice").style.display="none"},document.getElementById("bellaai-start-call").onclick=async function(){var t=document.getElementById("bellaai-phone-input").value.trim();if(t)try{o.remove(),await D("phone",t);var e=document.createElement("div");e.className="chat-message bot",e.innerHTML=S("I'm calling your phone now. Please answer to continue our conversation."),A.appendChild(e),A.scrollTop=A.scrollHeight}catch(e){console.error("Error initiating phone call:",e);t=document.createElement("div");t.className="chat-message bot",t.innerHTML=S("I couldn't connect to your phone. Please check the number and try again."),A.appendChild(t),A.scrollTop=A.scrollHeight}}}};var e=document.createElement("textarea"),o=(e.placeholder="Type your message here...",e.rows=1,e.style.resize="none",e.style.flex="1",e.style.marginRight="8px",e.className=B.className,document.createElement("button"));o.type="submit",o.innerHTML='<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>',o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center",o.style.background="linear-gradient(135deg, var(--chat--color-primary) 0%, var(--chat--color-secondary) 100%)",o.style.color="white",o.style.border="none",o.style.borderRadius="8px",o.style.padding="0 18px",o.style.cursor="pointer",o.style.fontWeight="500",o.style.fontSize="16px",o.style.height="40px",o.style.minWidth="40px",t.appendChild(a),t.appendChild(e),t.appendChild(o),o.addEventListener("click",_),e.addEventListener("keypress",function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),_())}),e.addEventListener("input",function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"}),window.bellaaiTextarea=e}}function W(){try{var e=localStorage.getItem("bella-chat-history");return e?JSON.parse(e):[]}catch(e){return console.error("Failed to parse chat history",e),[]}}function U(){return f.dealer||{}}async function D(e,t){var o={type:e,chatHistory:W(),dealerInfo:U()};if("phone"===e){if(!t)throw new Error("Phone number required for phone call");o.phone=t}e=await fetch("https://automation.cloudcovehosting.com/webhook/voice-call",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(e.ok)return e.json();throw t=await e.text(),new Error("Failed to initiate call: "+t)}function O(e){console.log("[BellaAI] startVoiceChatInWindow called with",e);var b=T.querySelector(".chat-input");if(b){b.innerHTML;b.innerHTML=`
          <div id="bellaai-voice-controls" style="width:100%;display:flex;flex-direction:column;align-items:center;">
            <div style="display:flex;align-items:center;justify-content:center;margin-bottom:0.5rem;">
              <div id="bellaai-voice-indicator" style="width:12px;height:12px;background:#ccc;border-radius:50%;margin-right:8px;"></div>
              <div id="bellaai-voice-status" style="color:#666;font-size:0.9rem;text-align:center;">Initializing...</div>
            </div>
            <button id="bellaai-voice-end" style="width:100%;padding:0.75rem 0;border-radius:8px;background:#003f72;color:#fff;font-weight:500;font-size:1rem;border:none;cursor:pointer;">End Voice Chat</button>
            <div id="bellaai-reconnection-info" style="margin-top:0.5rem;font-size:0.8rem;color:#666;display:none;text-align:center;">Connection lost. Attempting to reconnect...</div>
          </div>
        `,document.getElementById("bellaai-voice-animations")||((b=document.createElement("style")).id="bellaai-voice-animations",b.textContent=`
            @keyframes pulse {
              0% { opacity: 1; }
              50% { opacity: 0.5; }
              100% { opacity: 1; }
            }
            
            @keyframes recording-pulse {
              0% { transform: scale(1); opacity: 1; background-color: #c00; }
              50% { transform: scale(1.2); opacity: 0.7; background-color: #f00; }
              100% { transform: scale(1); opacity: 1; background-color: #c00; }
            }
          `,document.head.appendChild(b));let o=document.getElementById("bellaai-voice-status");b=document.getElementById("bellaai-voice-end");let s=document.getElementById("bellaai-voice-indicator"),a=document.getElementById("bellaai-reconnection-info"),r=null,c=null,t=null,n=null,i=null,d=!1,p=!1,l=Date.now(),h=!1,g=null,u=null,m=null,y=0,f=0,x=3;function w(e,t="#666"){o&&(o.textContent=e,o.style.color=t),s&&(s.style.background=t),console.log("[BellaAI] Status:",e)}function v(e,t=!1){var o=document.createElement("div");o.className="chat-message "+(t?"user":"bot"),t?o.textContent=e:o.innerHTML=S(e),A.appendChild(o),A.scrollTop=A.scrollHeight,E()}function k(e="Voice chat ended"){if(!d){if(console.log("[BellaAI] cleanup called:",e),v("Voice conversation ended: "+e,!(d=!0)),g&&clearInterval(g),u&&clearInterval(u),m&&clearInterval(m),window.BellaAIVoiceChatAudio.stop(),window.BellaAITranscriptTracking.reset(),r){try{1===r.readyState&&r.close()}catch(e){console.error("[BellaAI] Error closing WebSocket:",e)}r=null}if(n){try{n.disconnect()}catch(e){console.error("[BellaAI] Error disconnecting processor:",e)}n=null}if(i){try{i.disconnect()}catch(e){console.error("[BellaAI] Error disconnecting analyser:",e)}i=null}if(c){try{"closed"!==c.state&&c.close()}catch(e){console.error("[BellaAI] Error closing AudioContext:",e)}c=null}if(t){try{t.getTracks().forEach(e=>e.stop())}catch(e){console.error("[BellaAI] Error stopping mic stream:",e)}t=null}setTimeout(function(){M(),B=T.querySelector(".chat-input textarea"),L=T.querySelector(".chat-input button.send-button"),B&&L?(L.addEventListener("click",_),B.addEventListener("keypress",function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),_())}),B.addEventListener("input",function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"}),console.log("[BellaAI] Chat input fully restored with event listeners")):console.error("[BellaAI] Failed to find textarea or send button after restoration")},200)}}async function I(){if(d||f>=x)k("Connection lost. Please try again.");else{f++,a.style.display="block",a.textContent=`Connection lost. Attempting to reconnect (${f}/${x})...`;try{r&&1===r.readyState&&r.close(),await new Promise(e=>setTimeout(e,1e3)),C()}catch(e){console.error("[BellaAI] Reconnection error:",e),f>=x?k("Failed to reconnect. Please try again."):setTimeout(I,2e3)}}}function C(){(r=new WebSocket(e)).onopen=function(){console.log("[BellaAI] WebSocket connection established"),w("Connected, initializing agent..."),a.style.display="none",f=0,v("Voice mode activated. You can now speak with Bella. Your conversation will appear here as text.",!1);var e=W(),t=U();let o;o=e&&0<e.length?`You are a helpful product specialist for ${t.name||"our dealership"}. Continue the conversation based on the previous chat history. IMPORTANT: Do not repeat introductions or greetings as we are transitioning from text to voice mode. The user will see your responses as text while also hearing them as voice.`:`You are a helpful product specialist for ${t.name||"our dealership"}. The user will see your responses as text while also hearing them as voice. Keep responses concise and avoid repeating the same information in different messages.`,console.log("[BellaAI] Sending conversation config");t={type:"conversation_initiation_client_data",conversation_config_override:{agent:{prompt:{prompt:o},language:"en"},tts:{voice_id:"21m00Tcm4TlvDq8ikWAM"}},custom_llm_extra_body:{temperature:.7,max_tokens:150},dynamic_variables:{user_name:"",account_type:""}};e&&0!==e.length||(t.conversation_config_override.agent.first_message="I'll be speaking with you now. How can I help you?"),r.send(JSON.stringify(t)),l=Date.now(),m&&clearInterval(m),m=setInterval(()=>{d||3e4<Date.now()-l&&(console.warn("[BellaAI] No ping received in 30s, connection may be lost"),I())},1e4)},r.onmessage=function(e){try{console.log("[BellaAI] WebSocket message received:",e.data.substring(0,150)+"...");var t,o,a,n,i=JSON.parse(e.data);"conversation_initiation_metadata"===i.type?(console.log("[BellaAI] Conversation initiated, ID:",i.conversation_initiation_metadata_event?.conversation_id),p=!0,w("Listening...","#090"),window.BellaAITranscriptTracking.currentConversationId=i.conversation_initiation_metadata_event?.conversation_id||null):"audio"===i.type&&i.audio_event&&i.audio_event.audio_base_64?(console.log("[BellaAI] Received audio"),(async e=>{if(c)try{var t=atob(e),o=new ArrayBuffer(t.length),a=new Uint8Array(o);for(let e=0;e<t.length;e++)a[e]=t.charCodeAt(e);var n=c.createBuffer(1,a.length/2,16e3),i=n.getChannelData(0),r=new Int16Array(a.buffer);for(let e=0;e<r.length;e++)i[e]=r[e]/32768;var l=c.createBufferSource();l.buffer=n,l.connect(c.destination),window.BellaAIVoiceChatAudio.play(l),w("Bella is speaking...","#090"),s.style.animation="pulse 1s infinite",s.style.background="#090",l.onended=()=>{console.log("[BellaAI] Audio playback completed"),window.BellaAIVoiceChatAudio.currentSource=null,!d&&p&&(w("Listening...","#090"),s)&&(s.style.animation="")}}catch(e){console.error("[BellaAI] Error playing audio:",e)}})(i.audio_event.audio_base_64)):"user_transcript"===i.type&&i.user_transcription_event?(t=i.user_transcription_event.user_transcript,console.log("[BellaAI] User transcript:",t),t&&t.trim()&&((o=i.user_transcription_event.transcript_id)&&window.BellaAITranscriptTracking.lastUserTranscriptId===o?console.log("[BellaAI] Skipping duplicate user transcript"):(window.BellaAITranscriptTracking.lastUserTranscriptId=o,v(t,!0)))):"agent_response"===i.type&&i.agent_response_event?(a=i.agent_response_event.agent_response,console.log("[BellaAI] Agent response:",a),(n=i.agent_response_event.response_id)&&window.BellaAITranscriptTracking.lastAgentResponseId===n?console.log("[BellaAI] Skipping duplicate agent response"):(window.BellaAITranscriptTracking.lastAgentResponseId=n,a&&a.trim()&&v(a,!1))):"ping"===i.type&&(console.log("[BellaAI] Ping received, sending pong"),l=Date.now(),i.ping_event)&&i.ping_event.event_id&&r.send(JSON.stringify({type:"pong",event_id:i.ping_event.event_id}))}catch(e){console.error("[BellaAI] Error processing WebSocket message:",e)}},r.onerror=function(e){console.error("[BellaAI] WebSocket error:",e),d||I()},r.onclose=function(e){console.log("[BellaAI] WebSocket closed:",e.code,e.reason),d||(1e3===e.code?k("Voice chat completed"):0===y?k("No audio detected, please try again"):I())}}b.onclick=()=>{console.log("[BellaAI] End Voice Chat button clicked"),k("Voice chat ended by user")},(async()=>{try{w("Requesting microphone access..."),window.BellaAIVoiceChatAudio.stop(),window.BellaAITranscriptTracking.reset(),t=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}}),c=new(window.AudioContext||window.webkitAudioContext),console.log("[BellaAI] AudioContext created with sampleRate:",c.sampleRate);var e=c.createMediaStreamSource(t);(i=c.createAnalyser()).fftSize=256,e.connect(i),n=c.createScriptProcessor(4096,1,1),e.connect(n),n.connect(c.destination),w("Connecting to Audio..."),C();let o=new Uint8Array(i.frequencyBinCount);g=setInterval(()=>{var e,t;d||(i.getByteFrequencyData(o),e=o.reduce((e,t)=>e+t,0)/o.length,t=h,(h=5<e)&&p?t?(w("Listening...","#c00"),s.style.animation="pulse 1s infinite",s.style.background="#c00"):(w("Listening...","#c00"),s&&(s.style.animation="recording-pulse 1s infinite")):p&&t&&(w("Listening...","#090"),s)&&(s.style.animation=""))},100),n.onaudioprocess=async function(t){if(!d&&r&&1===r.readyState&&p){let e=t.inputBuffer.getChannelData(0);if(16e3!==c.sampleRate)try{e=await(async(t,e)=>{if(console.log("[BellaAI] Resampling from",e,"Hz to 16000 Hz"),16e3===e)return t;var o=Math.ceil(t.length*(16e3/e)),o=new OfflineAudioContext(1,o,16e3),a=((e=o.createBuffer(1,t.length,e)).copyToChannel(t,0),o.createBufferSource());a.buffer=e,a.connect(o.destination),a.start(0);try{return(await o.startRendering()).getChannelData(0)}catch(e){return console.error("[BellaAI] Resampling error:",e),t}})(e,c.sampleRate)}catch(e){console.error("[BellaAI] Resampling error:",e)}t=(e=>{var t=new Uint8Array(e.buffer);let o="";for(let e=0;e<t.byteLength;e++)o+=String.fromCharCode(t[e]);return btoa(o)})((t=>{var o=new Int16Array(t.length);for(let e=0;e<t.length;e++){var a=Math.max(-1,Math.min(1,t[e]));o[e]=a<0?32768*a:32767*a}return o})(e));r.send(JSON.stringify({user_audio_chunk:t})),++y%25==0&&console.log("[BellaAI] Sent",y,"audio chunks")}}}catch(e){console.error("[BellaAI] Error in voice session:",e),k("Error: "+(e.message||"Could not start voice session"))}})()}}(l=document.createElement("style")).textContent=`
        @keyframes bellaai-fadein {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        .bellaai-overtake-overlay {
          animation: bellaai-fadein 0.4s forwards;
        }
        .overtake-modal .brand-header {
          padding-bottom: 12px;
          border-bottom: 1px solid #f0f0f0;
          margin-bottom: 12px;
        }
        .overtake-modal .brand-header img {
          width: 40px;
          height: 40px;
          margin-right: 10px;
        }
        .overtake-modal .brand-header span {
          font-size: 22px;
          font-weight: 600;
        }
        .overtake-modal .close-button {
          position: absolute;
          right: 18px;
          top: 18px;
          background: none;
          border: none;
          cursor: pointer;
          font-size: 28px;
          color: #888;
          opacity: 0.7;
          z-index: 2;
          transition: opacity 0.2s;
        }
        .overtake-modal .close-button:hover {
          opacity: 1;
        }
        .overtake-modal .chat-messages {
          flex: 1;
          overflow-y: auto;
          padding: 10px 0 10px 0;
          margin-bottom: 10px;
          background: none;
          min-height: 400px;
        }
        .overtake-modal .chat-input {
          padding: 0;
          border-top: 1px solid #f0f0f0;
          margin-top: 10px;
          background: none;
          display: flex;
          align-items: center;
        }
        .overtake-modal .chat-input textarea {
          flex: 1 !important;
          padding: 12px !important;
          border: 1px solid rgba(133, 79, 255, 0.2) !important;
          border-radius: 8px !important;
          resize: none !important;
          font-family: inherit !important;
          font-size: 14px !important;
          height: auto !important;
          min-height: 40px !important;
          max-height: 120px !important;
          width: auto !important;
          box-sizing: border-box !important;
          margin-right: 8px;
        }
        .overtake-modal .chat-input button[type="submit"] {
          background: linear-gradient(135deg, var(--chat--color-primary) 0%, var(--chat--color-secondary) 100%);
          color: #fff;
          border: none;
          border-radius: 8px;
          padding: 0 18px;
          cursor: pointer;
          font-weight: 500;
          font-size: 16px;
          height: 40px;
          min-width: 40px;
          display: flex;
          align-items: center;
          justify-content: center;
        }
        .overtake-modal .chat-input button[type="submit"] svg {
          fill: #fff;
          stroke: #fff;
        }
        .overtake-modal .chat-message.user {
          background: linear-gradient(135deg, var(--chat--color-primary) 0%, var(--chat--color-secondary) 100%);
          color: #fff;
          align-self: flex-end;
          box-shadow: 0 4px 12px rgba(133, 79, 255, 0.2);
          border-radius: 12px;
          padding: 12px 16px;
          margin: 8px 0;
          max-width: 80%;
          word-wrap: break-word;
          font-size: 14px;
          line-height: 1.5;
        }
        @media (max-width: 600px) {
          .overtake-modal {
            padding: 0 !important;
          }
          .overtake-modal .brand-header img {
            width: 32px;
            height: 32px;
          }
          .overtake-modal .brand-header span {
            font-size: 18px;
          }
          .overtake-modal .chat-messages {
            min-height: 200px;
          }
        }
        .overtake-modal {
          height: 60vh;
          max-height: 60vh;
          display: flex;
          flex-direction: column;
        }
        .overtake-modal .chat-messages {
          flex: 1 1 0%;
          overflow-y: auto;
          min-height: 0;
        }
        @media (max-width: 600px) {
          .overtake-modal {
            height: 85vh !important;
            max-height: 85vh !important;
          }
        }
      `,document.head.appendChild(l),(e=document.createElement("style")).textContent=`
        .overtake-modal {
          width: 800px !important;
          max-width: 95vw;
        }
        @media (max-width: 900px) {
          .overtake-modal {
            width: 95vw !important;
          }
        }
        @media (max-width: 600px) {
          .overtake-modal {
            width: 95vw !important;
            height: 85vh !important;
            max-height: 85vh !important;
            border-radius: 12px !important;
            padding: 16px 6px 10px 6px !important;
          }
        }
      `,document.head.appendChild(e),l=f.overtakePath||"/",!0!==f.overtake||window.location.pathname!==l||localStorage.getItem("bellaaiOvertakeShown")||setTimeout(()=>{(C=document.createElement("div")).className="bellaai-overtake-overlay",C.style.position="fixed",C.style.inset="0",C.style.background="rgba(0,0,0,0.6)",C.style.zIndex="2147483646",C.style.display="flex",C.style.alignItems="center",C.style.justifyContent="center",C.style.transition="opacity 0.4s",C.style.opacity="0",C.style.animation="bellaai-fadein 0.4s forwards",T.classList.add("overtake-modal"),T.style.position="relative",T.style.left="",T.style.top="",T.style.transform="",T.style.zIndex="2147483647",T.style.width="800px",T.style.height="auto",T.style.maxHeight="90vh",T.style.borderRadius="18px",T.style.boxShadow="0 8px 32px rgba(0,0,0,0.25)",T.style.opacity="0",T.style.background="#fff",T.style.display="flex",T.style.flexDirection="column",T.style.padding="32px 28px 20px 28px",T.style.transition="opacity 0.4s",setTimeout(()=>{T.style.opacity="1"},50),window.innerWidth<=900&&(T.style.width="95vw"),window.innerWidth<=600&&(T.style.width="95vw",T.style.height="85vh",T.style.maxHeight="85vh",T.style.borderRadius="12px",T.style.padding="16px 6px 10px 6px"),c.classList.add("hidden"),document.body.appendChild(C),C.appendChild(T),document.body.style.overflow="hidden",localStorage.setItem("bellaaiOvertakeShown","1"),H()},400),window.BellaAIChatWidgetChatInitialized||(window.BellaAIChatWidgetChatInitialized=!0,n()||(y=!1,u=a(),I(),w()),E(),A.scrollTop=A.scrollHeight,x(),clearTimeout(i),c.addEventListener("click",function(){H()}),d.addEventListener("click",function(){N(),o(t=!0),window.innerWidth<=600&&(document.body.style.overflow="")}),L.addEventListener("click",_),B.addEventListener("keypress",function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),_())}),B.addEventListener("input",function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"}),window.addEventListener("resize",function(){window.innerWidth<=600?T.classList.contains("open")&&(document.body.style.overflow="hidden"):document.body.style.overflow=""})),M(),(e=document.createElement("style")).textContent=`
        .chat-message.user {
          background: linear-gradient(135deg, var(--chat--color-primary) 0%, var(--chat--color-secondary) 100%);
          color: white;
          align-self: flex-end;
          box-shadow: 0 4px 12px rgba(133, 79, 255, 0.2);
          border-radius: 12px;
          padding: 12px 16px;
          margin: 8px 0;
          max-width: 80%;
          word-wrap: break-word;
          font-size: 14px;
          line-height: 1.5;
        }
        .chat-message.bot {
          background: #ffffff;
          border: 1px solid rgba(133, 79, 255, 0.2);
          color: #333;
          align-self: flex-start;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
          border-radius: 12px;
          padding: 12px 16px;
          margin: 8px 0;
          max-width: 80%;
          word-wrap: break-word;
          font-size: 14px;
          line-height: 1.5;
        }
        .chat-input {
          display: flex;
          align-items: center;
          gap: 8px;
          padding: 0;
          border-top: 1px solid #f0f0f0;
          margin-top: 10px;
          background: none;
        }
        .chat-input textarea {
          flex: 1 !important;
          padding: 12px !important;
          border: 1px solid rgba(133, 79, 255, 0.2) !important;
          border-radius: 8px !important;
          resize: none !important;
          font-family: inherit !important;
          font-size: 14px !important;
          height: auto !important;
          min-height: 40px !important;
          max-height: 120px !important;
          width: auto !important;
          box-sizing: border-box !important;
          margin-right: 8px;
        }
        .chat-input button[type="submit"] {
          background: linear-gradient(135deg, var(--chat--color-primary) 0%, var(--chat--color-secondary) 100%);
          color: white;
          border: none;
          border-radius: 8px;
          padding: 0 18px;
          cursor: pointer;
          font-weight: 500;
          font-size: 16px;
          height: 40px;
          min-width: 40px;
          display: flex;
          align-items: center;
          justify-content: center;
        }
      `,document.head.appendChild(e),document.addEventListener("keydown",function(e){"Escape"===e.key&&(C?z():T.classList.contains("open")&&N())})})();